-- NVChad custom init to set core options as requested
local opt = vim.opt

-- Truecolor for better highlighting
opt.termguicolors = true

-- Ensure syntax highlighting and filetype detection/indentation
vim.cmd([[syntax on]])
vim.cmd([[filetype plugin indent on]])

-- Spelling and completion UI defaults
opt.spell = false
opt.spelllang = "en_us"
opt.completeopt = "menu,menuone,noselect"

-- Enable completion popup in all buffers (including markdown) via nvim-cmp spell + buffer
vim.api.nvim_create_autocmd({"BufEnter","InsertEnter"}, {
  callback = function()
    -- For spell to underline suggestions in markdown/text
    if vim.bo.filetype == "markdown" or vim.bo.filetype == "text" then
      vim.opt_local.spell = true
      vim.opt_local.spelllang = "en_us"
    end
  end,
})

-- Line numbers
opt.number = true
opt.relativenumber = false
vim.wo.number = true
vim.wo.relativenumber = false

-- Line indicators (ruler at 80) disabled by default. Re-enable by uncommenting:
-- opt.colorcolumn = "80,81"
-- vim.api.nvim_set_hl(0, "ColorColumn", { bg = "#434C5E" })

-- Wrap and hard wrap at 85
opt.wrap = true
opt.textwidth = 85
opt.formatoptions:append("t")

-- Sensible defaults for indentation (overridden by ftplugins below)
opt.expandtab = true
opt.shiftwidth = 2
opt.tabstop = 2
opt.smartindent = true

-- Highlight current line and column
opt.cursorline = true
vim.wo.cursorline = true
opt.cursorcolumn = false
opt.cursorlineopt = "both"

-- Enforce line numbers and cursorline on new windows/buffers
vim.api.nvim_create_autocmd({"VimEnter","WinEnter","BufWinEnter"}, {
  callback = function()
    vim.wo.number = true
    vim.wo.relativenumber = false
    vim.wo.cursorline = true
  end,
})

-- Enforce 85-char hard wrap locally on load and filetype changes
local wrapgrp = vim.api.nvim_create_augroup("CustomWrap85", { clear = true })
vim.api.nvim_create_autocmd({"BufRead","BufNewFile","FileType","BufEnter","InsertEnter"}, {
  group = wrapgrp,
  callback = function()
    -- enforce local textwidth
    vim.opt_local.textwidth = 85
    -- normalize formatoptions: ensure 't' present and remove 'l' that blocks wrapping
    local fo = vim.api.nvim_get_option_value('formatoptions', { scope = 'local' })
    fo = fo:gsub('l','')
    if not fo:match('t') then fo = fo .. 't' end
    vim.api.nvim_set_option_value('formatoptions', fo, { scope = 'local' })
  end,
})

-- Force highlight after colorscheme loads
vim.api.nvim_create_autocmd("ColorScheme", {
  callback = function()
    vim.api.nvim_set_hl(0, "CursorLine", { bg = "#2E3440" })
    vim.api.nvim_set_hl(0, "CursorLineNr", { fg = "#FFCC00", bold = true })
  end,
})

-- Also set highlights immediately and on VimEnter to ensure they stick
vim.api.nvim_set_hl(0, "CursorLine", { bg = "#2E3440" })
vim.api.nvim_set_hl(0, "CursorLineNr", { fg = "#FFCC00", bold = true })

vim.api.nvim_create_autocmd("VimEnter", {
  callback = function()
    vim.api.nvim_set_hl(0, "CursorLine", { bg = "#2E3440" })
    vim.api.nvim_set_hl(0, "CursorLineNr", { fg = "#FFCC00", bold = true })
  end,
})

-- Make cursor block blink in normal mode (and shapes per mode)
vim.o.guicursor = table.concat({
  "n-v-c:block-blinkon500-blinkoff500",
  "i-ci:ver25-blinkon300-blinkoff300",
  "r-cr:hor20",
  "o:hor20",
  "sm:block-blinkon300-blinkoff300",
}, ",")


